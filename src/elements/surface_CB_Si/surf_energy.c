#include "Tersoff_inc_surf.h"

#include <math.h>

static double z[53];

/* calculate the surface strain energy density */
double get_energy_surf(const double* params, const double *Xsi, const double *Xa, const double *Ya, const double *Za, const double* Cmat) {

/* common definitions */
#include "Tersoff_common_defines_surf.h"

	z[1] = c*c;
	z[2] = 1./(d*d);
	z[3] = d*d;
	z[4] = 1./n;
	z[5] = -X2;
	z[6] = -X3;
	z[7] = -Y2;
	z[8] = -Y3;
	z[9] = -Z2;
	z[10] = -Z3;
	z[2] = z[1]*z[2];
	z[11] = z[10] + Z2;
	z[4] = -0.5*z[4];
	z[12] = X3 + z[5];
	z[5] = X1 + Xs1 + z[5];
	z[13] = X2 + z[6];
	z[6] = X1 + Xs1 + z[6];
	z[14] = Y3 + z[7];
	z[7] = Y1 + Ys1 + z[7];
	z[15] = Y2 + z[8];
	z[8] = Y1 + Ys1 + z[8];
	z[16] = Z3 + z[9];
	z[10] = Z1 + z[10] + Zs1;
	z[9] = Z1 + z[9] + Zs1;
	z[17] = C31*z[11];
	z[18] = C32*z[11];
	z[19] = C33*z[11];
	z[20] = C11*z[12];
	z[21] = C12*z[12];
	z[22] = C13*z[12];
	z[23] = C11*z[5];
	z[24] = C12*z[5];
	z[25] = C13*z[5];
	z[26] = C11*z[13];
	z[27] = C12*z[13];
	z[28] = C13*z[13];
	z[29] = C11*z[6];
	z[30] = C12*z[6];
	z[31] = C13*z[6];
	z[32] = C21*z[14];
	z[33] = C22*z[14];
	z[34] = C23*z[14];
	z[35] = C21*z[7];
	z[36] = C22*z[7];
	z[37] = C23*z[7];
	z[38] = C21*z[15];
	z[39] = C22*z[15];
	z[40] = C23*z[15];
	z[41] = C21*z[8];
	z[42] = C22*z[8];
	z[43] = C23*z[8];
	z[44] = C31*z[16];
	z[45] = C32*z[16];
	z[46] = C33*z[16];
	z[47] = C31*z[10];
	z[48] = C32*z[10];
	z[49] = C33*z[10];
	z[50] = C31*z[9];
	z[51] = C32*z[9];
	z[52] = C33*z[9];
	z[17] = z[17] + z[26] + z[38];
	z[18] = z[18] + z[27] + z[39];
	z[19] = z[19] + z[28] + z[40];
	z[20] = z[20] + z[32] + z[44];
	z[21] = z[21] + z[33] + z[45];
	z[22] = z[22] + z[34] + z[46];
	z[26] = z[29] + z[41] + z[47];
	z[27] = z[30] + z[42] + z[48];
	z[28] = z[31] + z[43] + z[49];
	z[23] = z[23] + z[35] + z[50];
	z[24] = z[24] + z[36] + z[51];
	z[25] = z[25] + z[37] + z[52];
	z[13] = -z[13]*z[17];
	z[15] = -z[15]*z[18];
	z[11] = -z[11]*z[19];
	z[12] = -z[12]*z[20];
	z[14] = -z[14]*z[21];
	z[16] = -z[16]*z[22];
	z[6] = z[26]*z[6];
	z[8] = z[27]*z[8];
	z[10] = z[10]*z[28];
	z[5] = z[23]*z[5];
	z[7] = z[24]*z[7];
	z[9] = z[25]*z[9];
	z[6] = z[10] + z[6] + z[8];
	z[5] = z[5] + z[7] + z[9];
	z[7] = z[11] + z[13] + z[15] + z[5] + z[6];
	z[8] = z[12] + z[14] + z[16] + z[5] + z[6];
	z[9] = 1./sqrt(z[6]);
	z[6] = sqrt(z[6]);
	z[10] = 1./sqrt(z[5]);
	z[5] = sqrt(z[5]);
	z[6] = -z[6];
	z[7] = -0.5*z[10]*z[7]*z[9];
	z[8] = -0.5*z[10]*z[8]*z[9];
	z[9] = -lam*z[5];
	z[5] = -mu*z[5];
	z[10] = lam*z[6];
	z[6] = mu*z[6];
	z[9] = exp(z[9]);
	z[5] = exp(z[5]);
	z[10] = exp(z[10]);
	z[6] = exp(z[6]);
	z[7] = h + z[7];
	z[8] = h + z[8];
	z[9] = A*z[9];
	z[10] = A*z[10];
	z[7] = z[7]*z[7];
	z[8] = z[8]*z[8];
	z[7] = z[3] + z[7];
	z[3] = z[3] + z[8];
	z[7] = 1./z[7];
	z[3] = 1./z[3];
	z[1] = -z[1];
	z[7] = z[1]*z[7];
	z[1] = z[1]*z[3];
	z[2] = 1. + z[2];
	z[3] = z[2] + z[7];
	z[1] = z[1] + z[2];
	z[2] = beta*z[3];
	z[1] = beta*z[1];
	z[2] = pow(z[2],n);
	z[1] = pow(z[1],n);
	z[2] = 1. + z[2];
	z[1] = 1. + z[1];
	z[2] = pow(z[2],z[4]);
	z[1] = pow(z[1],z[4]);
	z[3] = -B*chi;
	z[2] = z[2]*z[3]*z[5];
	z[1] = z[1]*z[3]*z[6];
	z[1] = z[1] + z[10] + z[2] + z[9];
	z[1] = 0.5*z[1];

	/* output */
	return z[1];

}